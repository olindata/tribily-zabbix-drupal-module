<?php
// $Id: zabbix_bridge.install,v 1.2 2008/12/06 01:17:17 rmiddle Exp $
// Built for Drupal 6
/**
 * @file
 * Notifies administrator of new user registrations.
 */


/**
 * Implementation of hook_install().
 */
function zabbix_bridge_install() {
  //  Set the weight of the module lower so modules like logintobogie don't cause problmes.
  db_query("UPDATE {system} SET weight = 1002 WHERE name = 'zabbix_bridge'");

  drupal_install_schema('zabbix_bridge');
}

/**
 * Implementation of hook_schema().
 */
function zabbix_bridge_schema() {

    $schema = array();

    $schema['zabbix_drupal_account'] = array(
        'description' => 'Drupal-Zabbix Association',
        'fields' => array(
            'id' => array( 'type' => 'serial', 'unsigned' => TRUE, 'not null' => TRUE ),
            'drupal_uid' => array( 'type' => 'int', 'unsigned' => TRUE, 'not null' => TRUE ),
            'zabbix_uid' => array( 'type' => 'int', 'unsigned' => TRUE, 'not null' => TRUE ),
            'zabbix_usrgrp_id' => array( 'type' => 'int', 'size' => 'big', 'unsigned' => TRUE, 'not null' => TRUE ),
            'zabbix_hostgrp_id' => array( 'type' => 'int', 'size' => 'big', 'unsigned' => TRUE, 'not null' => TRUE )
        ),
        'primary key' => array('id'),
        'unique key' => array( 'zabbix_drupal_acc_UNIQUE' => array('drupal_uid', 'zabbix_uid') )
    );

    $schema['zabbix_role'] = array(
        'description' => 'Zabbix role',
        'fields' => array(
            'roleid' => array( 'type' => 'serial', 'unsigned' => TRUE, 'not null' => TRUE ),
            'name' => array( 'type' => 'varchar', 'not null' => TRUE, 'length' => 50 ),
            'description' => array( 'type' => 'varchar', 'not null' => FALSE, 'length' => 255 )
        ),
        'primary key' => array('roleid'),
        'unique key'
    );

    $schema['zabbix_roles_templates'] = array(
        'description' => 'Zabbix role-template association',
        'fields' => array(
            'roleid' => array( 'type' => 'int', 'unsigned' => TRUE, 'not null' => TRUE ),
            'templateid' => array( 'type' => 'int', 'unsigned' => TRUE, 'not null' => TRUE )
        ),
        'primary key' => array('roleid', 'templateid')
    );

    $schema['zabbix_hosts'] = array(
        'description' => 'Holds the hosts assigned to a user in zabbix',
        'fields' => array(
            'userid' => array( 'type' => 'int', 'unsigned' => TRUE, 'not null' => TRUE ),
            'hostid' => array( 'type' => 'serial', 'not null' => TRUE ),
            'zabbixhostid' => array( 'type' => 'int', 'unsigned' => TRUE, 'not null' => TRUE ),
            'ipaddress' => array( 'type' => 'varchar', 'length' => 15, 'not null' => FALSE ),
            'dns' => array( 'type' => 'varchar', 'length' => 64, 'not null' => FALSE ),
            'hostname' => array( 'type' => 'varchar', 'length' => 64, 'not null' => TRUE ),
            'enabled' => array( 'type' => 'int', 'size' => 'tiny', 'unsigned' => TRUE, 'not null' => TRUE ),
        ),
        'primary key' => array('hostid')
    );


    $schema['zabbix_hosts_roles'] = array(
        'description' => 'Connects hosts and their assigned roles',
        'fields' => array(
            'hostid' => array( 'type' => 'int', 'unsigned' => TRUE, 'not null' => TRUE ),
            'roleid' => array( 'type' => 'int', 'unsigned' => TRUE, 'not null' => TRUE ),
        ),
        'primary key' => array('hostid, roleid')
    );

    return $schema;

}

/**
 * Implementation of hook_uninstall().
 */
function zabbix_bridge_uninstall() {

    drupal_uninstall_schema('zabbix_bridge');

}
